#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>

int main()
{
	int X[] = {-16, 47, 205, -244, -193, 37, 68, -75, 190, -38, 243, -142, 98, -22, -246, 74, 115, 202, -13, -61, 59, -103, -195, 208, -160, 242, 217, 230, 238, 108, 77, 69, -73, 197, -21, 117, 157, 221, -95, -77, -27, -210, 189, 110, -241, -72, 93, 121, -229, -96, 34, -106, -250, 73, 4, 40, -100, 152, 114, 223, -35, -141, -43, 89, 83, -104, 168, 234, 90, -242, -137, 67, -80, 54, -221, -239, -120, -42, 160, -53, -59, 87, 163, 245, 2, 43, 65, 228, 80, -6, -175, -138, 70, -218, -50, 126, -148, 180, -92, 104, -156, -191, 233, 49, -167, -213, 246, 0, -78, -245, 138, 130, 32, 92, -153, -161, -28, -196, 46, 182, -118, 239, 82, -110, 102, 171, 142, 141, -249, -139, -97, -202, 237, 97, 232, 106, -222, 125, 172, -207, -183, 139, -219, 212, -40, -170, -107, -18, -154, -197, -11, 79, 198, 58, -150, -76, -71, -220, 196, -93, -99, -15, 9, 240, -67, -135, -225, -133, 225, 176, -29, 105, -203, -136, 127, 116, -231, 8, 76, -178, 24, 33, 29, 131, -165, -57, -209, 193, 128, -85, 133, -184, -12, -19, 107, -26, 10, 103, -4, 200, 81, 71, 18, 100, -101, 53, 155, 15, 186, -201, 23, 191, -123, 144, -3, 159, -45, -194, 135, -117, 227, -47, -32, -52, -232, -90, 137, -147, -30, -237, -83, 183, 148, 161, 1, 211, 145, -190, -181, -86, -208, 136, -235, -214, 175, -113, 177, 50, 215, 119, 179, -51, -7, -186, -34, -143, 27, 78, -54, -63, -56, 112, -200, -55, -130, -24, -159, 95, -192, 132, 17, 226, -79, -105, -94, 154, 124, 146, -157, -238, -240, -37, -74, 162, -179, -199, -17, -8, -205, 120, 249, 247, 3, -124, 174, -102, -182, 28, -204, 140, -216, -44, -36, -217, -185, 63, -131, -243, 31, 109, -88, 229, 52, -119, 165, -121, -115, -151, 94, 5, -228, -149, -188, 181, -248, 21, 187, 166, 199, -227, 39, -65, -155, 185, -14, 169, -5, 96, 75, 204, 88, -114, 143, 99, 167, -236, 170, -62, -46, 85, -33, -132, -116, 210, 101, 62, -109, 241, 51, 60, 213, -169, -70, 11, -31, 14, 129, 56, -41, 216, 84, 45, 122, 86, -49, 235, 48, 192, 16, 22, -206, 41, -223, -126, 194, -176, -68, 222, 218, -211, 173, -158, -164, -230, -1, -134, -152, -91, -111, 150, -23, 214, 184, 224, -233, -163, 19, -187, -66, -168, -173, -247, 7, 25, 134, 147, -89, -189, -166, 12, -48, 248, 55, 72, -129, 149, -39, -128, 206, 26, -125, 195, -112, 61, -212, 36, 44, 231, -25, -172, 20, -145, 220, 91, -87, -58, 188, -82, 164, -69, -20, 209, 219, -127, 57, -171, 151, -234, 111, -177, 38, -60, -226, 30, -84, 236, 6, -146, -198, 207, 250, 158, -108, 13, 64, 244, -215, 113, 201, 178, -64, -180, -140, -224, -9, 203, 156, -2, -162, 123, -10, -174, -98, -122, 42, 153, -81, 66, 118, -144};
	int	n = 500;
	// P = array of length N
	int	*P = malloc(n * 4);
	// M = array of length N + 1
	int	*M = malloc((n + 1) * 4);
	M[0] = -1; // undefined so can be set to any value

	int	lo;
	int	hi;

	int mid;

	int	newL;

	int L = 0;
	int i = 0;
	// lo = 1;
	// hi = L + 1;
	while (i < n)
	{
	// for i in range 0 to N-1:
		// Binary search for the smallest positive l â‰¤ L
		// such that X[M[l]] > X[i]
		lo = 1;
		hi = L + 1;
		while (lo < hi)
		{
			mid = lo + (hi-lo)/2; // lo <= mid < hi
			if (X[M[mid]] >= X[i])
				hi = mid;
			else // if X[M[mid]] < X[i]
				lo = mid + 1;
		}
		// After searching, lo == hi is 1 greater than the
		// length of the longest prefix of X[i]
		newL = lo;

		// The predecessor of X[i] is the last index of 
		// the subsequence of length newL-1
		P[i] = M[newL-1];
		M[newL] = i;
		
		if (newL > L)
			L = newL;
			// If we found a subsequence longer than any we've
			// found yet, update L
			// L = newL;
		i++;
	}
	// Reconstruct the longest increasing subsequence
	// It consists of the values of X at the L indices:
	// ...,  P[P[M[L]]], P[M[L]], M[L]
	int	k;
	printf("L - 1: %d\n", L - 1);
	// S = array of length L
	int	*S = malloc(L * 4);
	k = M[L];
	int j = L - 1;
	while (j >= 0)
	{
	// for j in range L-1 to 0:
		printf("%d ", X[k]);
		S[j] = X[k];
		k = P[k];
		j--;
	}
	printf("\n");
	free(P);
	free(M);
	free(S);
	// return (S);
}